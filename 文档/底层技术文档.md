# 一、总体说明

## 1.数据结构

数据结构（或数据模块）的形式为 

```c++
//此代码块已经废弃！ 
(string ISBN, string value[]{id, name, author, type,  borrowtime, returntime, history, onshelf, isovertime})
//onshelf, isovertime两个变量的取值为0或1，对应类中bool值，使用时转换类型即可。
```

```c++
(string ISBN, string value)
//value字符串的长度固定为60，包含：id, name, author, type,  borrowtime, returntime, history, onshelf, isovertime。
//onshelf, isovertime两个变量的取值为0或1，对应类中bool值，使用时转换类型即可。
```



​	在上述数据结构中限定ISBN长度为4，id长度为6，name长度为8，author长度为4，type长度为4，borrowtime格式yy-mm-dd，returntime同，长度各为8。history长度为16，onshelf、isovertime长度为1，取值为0或1。value字符串的格式如下：

![image-20201013090649894](C:\Users\Lucius\AppData\Roaming\Typora\typora-user-images\image-20201013090649894.png)



​	主要的功能为增加、删除、修改、查询，数据结构为B+树，此种数据结构可以保持数据稳定有序，插入、修改有较稳定的对数时间复杂度![image-20201012211813060](C:\Users\Lucius\AppData\Roaming\Typora\typora-user-images\image-20201012211813060.png)。

​	使用cache作为缓冲区，利用文件读取的局部性加速读写，cache在内存中，断电不保存。

## 2.文件设计

### 	1.索引文件

​	每个数据的长度为4个字节，用文件开始的4个字节记录根节点所在地址，若为0则树为空，初始时默认为0。用其后的4个字节标记文件中第一个空白的位置，初值置为8（文件尾）。然后依次是每个节点。每个节点分为三个部分，第一部分为12个字节，3个整数，分别是**父节点地址、此节点的序号、当前节点关键字的个数**（记录方法类似数组，从0开始读写），根节点不记录上述数据。第二部分为变长，每8个字节记录一组数据：若节点不是叶子，则记录的是**当前节点的关键字**和**该节点孩子的地址**；若节点是叶子，则记录的是**当前节点的关键字和关键字对应的键值的存储地址**（在数据文件中；保存为负数，以便区分叶子节点）。对于叶子，第三部分为4个字节，表示**下一个叶子节点的地址**；非叶子节点不含有此部分。

​	此外，空白位置组成单项链表，最后一项始终为文件末尾。删除节点后将地址链接到链表头部。

### 	2.数据文件

​	数据文件前4个字节为第一个空白的位置，初值置为4。每条数据60个字节。对空白的处理同上。	

### 3.日志文件设计说明

程序中的每次操作会将相关信息写入日志文件，主要用于调试。具体形式为：[][][时间] [操作] [数据]。

